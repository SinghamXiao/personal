####Effective Java第二版学习笔记

    一、Java内存泄漏：长生命周期的对象持有短生命周期对象的引用
                  
        类自己管理内存；
        
        缓存；
        
        容器 / 静态集合类，当集合里面的对象属性被修改后，再调用remove()方法时不起作用；
        
        各种连接，数据库连接，网络连接(socket)和I/O连接；
        
        内部类和外部模块的引用；
        
        单例模式，当持有外部引用时；
        
        监听和其他回调。
    
    二、避免使用终结方法(finalizer)
      
        终结方法(finalizer)通常是不可预测的，也是很危险的，一般情况下是不必要的。
      
        不要把finalizer当成C++中析构函数的对应物。java中，当对象不可达时（即没有引用指向这个对象时），会由垃圾回收器来回收与该对象相关联的内存资源；而其他的内存资源，则一般由try-finally代码块来完成类似的工作。
        
        1.finalizer的缺点：
          
            1）终结方法的缺点在于不能保证会被及时地执行。
            
                及时执行finalizer方法是JVM垃圾回收方法的一个主要功能。由于不同JVM的垃圾回收算法不同，JVM会“非故意的”延迟执行终结方法，因此终结方法的执行时间点是非常不稳定的。
            
            2）finalizer方法的线程优先级比当前程序的其他线程优先级要低，且JAVA语言规范不保证哪个线程可以执行finalizer方法。
            
            3）JAVA语言规范不仅不保证及时执行finalizer方法，还不保证一定会执行finalizer方法。当程序终止时，有可能一些对象的finalizer方法还没有执行。——不应该依赖finalizer方法来更新重要的持久状态。
            
            4）System.gc和System.runFinalization不保证finalizer一定执行。
            
            5）System.runFinalizersOnExit Runtime.runFinalizersOnExit 可以保证finalizer一定执行，但是这两个方法已经废弃。
            
            6）如果未捕获的异常在finalizer方法中抛出来，这个异常可以被忽略（警告都不会打印出来），且finalizer方法会终止。这样这个异常就使对象处于“被破坏”的状态，如果另一个线程要使用这个对象，就可能发生不确定的行为。
            
            7）finalizer方法会有非常严重的（Severe）性能损失
    
        2. 终结方法的合法用途。
                       
            1）作为安全网——显示终止方法忘记调用的时候
            
            2）终止非关键的本地资源（android JNI操作中）
            
            终结方法的执行过程中要保证：如果子类的终结过程出现异常，超类的终结过程也会得到执行。
           
        总结：
        
            1）除非是作为安全网或者是为了终结非关键的本地资源，否则请不要使用终结方法。
            
            2）如果确实需要，可以使用显示终止方法
            
            3）如果没办法真的使用了finalize，别忘记了调用super.finalize()。还可以考虑是否使用终结方法守卫者，使未调用super.finalize()方法的类的父类的终结方法也会被执行。
